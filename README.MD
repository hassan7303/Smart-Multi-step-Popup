# 📦 Smart Multi-step Popup

پلاگین **Smart Multi-step Popup** برای وردپرس یک افزونه‌ی سبک و حرفه‌ای است که به شما اجازه می‌دهد فرم‌های چندمرحله‌ای با شرط‌های هوشمند، نمایش زمان‌دار و کنترل اسلاگ بسازید.

این فرم‌ها می‌توانند به‌صورت پاپ‌آپ روی صفحات خاص سایت نمایش داده شوند و برای دریافت اطلاعات، مشاوره، ثبت‌نام یا فروش عالی هستند.

---

## ⚙️ ویژگی‌ها

✅ ساخت پاپ‌آپ با چند مرحله (Step)  
✅ پشتیبانی از شرط‌های وابسته بین مراحل  
✅ تعیین اسلاگ (slug) برای نمایش در صفحات خاص  
✅ تأخیر نمایش و درصد اسکرول برای فعال شدن  
✅ جلوگیری از نمایش مجدد تا مدت زمان دلخواه  
✅ پشتیبانی از فیلدهای متنوع (متن، شماره، گزینه، چک‌باکس و ...)  
✅ امکان پرش خودکار به مرحله بعد پس از انتخاب  
✅ امکان اضافه کردن توضیحات یا یادداشت رنگی در هر مرحله

---

## 🧩 تنظیمات در بخش مدیریت

در مسیر **پیشخوان → Smart Popups** می‌توانید:

| گزینه            | توضیح                                                                          |
| ---------------- | ------------------------------------------------------------------------------ |
| **Title**        | عنوان پاپ‌آپ                                                                   |
| **Slugs**        | اسلاگ‌های صفحه‌هایی که باید پاپ‌آپ در آنها نمایش داده شود (با ویرگول جدا کنید) |
| **Delay (s)**    | تاخیر نمایش بر حسب ثانیه                                                       |
| **Scroll (%)**   | درصد اسکرول برای فعال شدن پاپ‌آپ (۰ یعنی بدون نیاز به اسکرول)                  |
| **Reopen (min)** | فاصله زمانی برای نمایش مجدد پاپ‌آپ (بر حسب دقیقه)                              |
| **Active**       | فعال / غیرفعال بودن پاپ‌آپ                                                     |
| **Form JSON**    | ساختار فرم چندمرحله‌ای به‌صورت JSON (در ادامه توضیح داده شده)                  |

---

## 🧱 ساختار کلی JSON فرم

فرم از چند مرحله (`steps`) تشکیل شده است:

```json
{
  "steps": [
    {
      "id": "s1",
      "title": "عنوان مرحله",
      "description": "توضیح یا راهنمای مرحله (اختیاری)",
      "fields": [ ... ],
      "condition": {
        "field": "status",
        "equals": "در حال نوشتن"
      }
    }
  ]
}
```

## 🟢 توضیح کلیدها:

| کلید            | نوع                | توضیح                                             |
| --------------- | ------------------ | ------------------------------------------------- |
| **id**          | string             | شناسه یکتا برای مرحله                             |
| **title**       | string             | عنوان مرحله (نمایش در بالای فرم)                  |
| **description** | string _(اختیاری)_ | توضیح کوتاه یا متن راهنما برای مرحله              |
| **fields**      | array              | مجموعه فیلدهای این مرحله                          |
| **condition**   | object _(اختیاری)_ | شرط نمایش مرحله، بر اساس مقدار فیلد مرحله‌های قبل |

🧾 انواع فیلدها (Fields)

هر مرحله شامل یک یا چند فیلد است که ساختارشان به شکل زیر است:

```
{
  "type": "text",
  "name": "fullname",
  "label": "نام و نام خانوادگی",
  "required": true
}
```

## 🔹 فیلدهای پشتیبانی‌شده:

| نوع فیلد                  | مقدار `type` | توضیح                                        |
| ------------------------- | ------------ | -------------------------------------------- |
| **متن کوتاه**             | `"text"`     | برای نام، ایمیل و ...                        |
| **ایمیل**                 | `"email"`    | ورودی ایمیل با اعتبارسنجی خودکار             |
| **شماره تلفن**            | `"tel"`      | برای شماره تماس                              |
| **گزینه‌ای (تک انتخاب)**  | `"choice"`   | مجموعه گزینه‌ها به صورت رادیویی              |
| **چندگزینه‌ای**           | `"checkbox"` | مجموعه گزینه‌ها با امکان چند انتخاب          |
| **یادداشت یا توضیح رنگی** | `"note"`     | نمایش توضیح درون کادر رنگی (بدون فیلد ورودی) |
| **HTML سفارشی**           | `"html"`     | افزودن هر نوع HTML دلخواه                    |

##

## ⚙️ ویژگی‌های فیلدها

| کلید                 | توضیح                                                                             |
| -------------------- | --------------------------------------------------------------------------------- |
| **name**             | نام یکتا برای ذخیره مقدار فیلد                                                    |
| **label**            | عنوان فیلد (متن کنار ورودی)                                                       |
| **options**          | آرایه گزینه‌ها (فقط در فیلدهای `choice` و `checkbox`)                             |
| **required**         | اگر `true` باشد، بدون پر کردن اجازه رفتن به مرحله بعد را نمی‌دهد                  |
| **autoNextOnChoice** | در فیلدهای `choice` باعث می‌شود بعد از انتخاب گزینه، فرم خودکار به مرحله بعد برود |
| **content**          | فقط برای فیلد `note` استفاده می‌شود و محتوای داخل آن نمایش داده می‌شود            |

اگر بخواهید مرحله‌ای فقط در شرایط خاص نمایش داده شود، از کلید condition استفاده کنید.

مثال شرط ساده:

```json
"condition": {
  "field": "status",
  "equals": "در حال نوشتن یا آماده‌ی چاپ است"
}
```

یعنی اگر در مرحله قبل فیلدی به‌نام status برابر این مقدار بود، این مرحله نمایش داده می‌شود.

مثال چند شرطی (OR):

```json
"condition": {
  "any": [
    {"field": "status", "equals": "در حال نوشتن"},
    {"field": "status", "equals": "شروع نکرده‌ام"}
  ]
}
```

💬 مثال کامل فرم چاپ کتاب

```json
{
  "steps": [
    {
      "id": "s1",
      "title": "۱) آیا کتابی در دست نوشتن یا چاپ دارید؟",
      "fields": [
        {                    
          "type": "note",                                                                    
          "name": "intro",
          "content": "جهت دریافت مشاوره رایگان چاپ کتاب لطفا فرم زیر را تکمیل کنید."
        },
        {
          "type": "choice",
          "name": "status",
          "label": "",
          "options": [
            "در حال نوشتن یا آماده‌ی چاپ است",
            "هنوز نوشتن را شروع نکرده‌ام"
          ],
          "required": true,
          "autoNextOnChoice": true
        }
      ]
    },
    {
      "id": "s2",
      "title": "۲) موضوع کتاب شما چیست؟",
      "condition": {
        "field": "status",
        "equals": "در حال نوشتن یا آماده‌ی چاپ است"
      },
      "fields": [
        {
          "type": "choice",
          "name": "topic",
          "label": "",
          "options": [
            "رمان، شعر و دل‌نوشته",
            "کودک و نوجوان",
            "مذهبی",
            "روانشناسی و مدیریت",
            "آموزشی و دانشگاهی"
          ],
          "required": true,
          "autoNextOnChoice": true
        }
      ]
    },
    {
      "id": "s3",
      "title": "۳) برای چاپ کتاب خود چه خدماتی نیاز دارید؟",
      "condition": {
        "field": "status",
        "equals": "در حال نوشتن یا آماده‌ی چاپ است"
      },
      "fields": [
        {
          "type": "checkbox",
          "name": "services",
          "label": "",
          "options": [
            "فقط مجوز کتاب",
            "ویراستاری",
            "صفحه‌آرایی",
            "طراحی جلد",
            "نشر الکترونیک",
            "نیاز به مشاوره دارم"
          ],
          "required": false
        }
      ]
    },
    {
      "id": "s4",
      "title": "۴) برای چاپ کتاب خود حاضرید چه میزان سرمایه‌گذاری کنید؟",
      "condition": {
        "field": "status",
        "equals": "در حال نوشتن یا آماده‌ی چاپ است"
      },
      "fields": [
        {
          "type": "choice",
          "name": "budget",
          "label": "",
          "options": [
            "بیش از ۱۵ میلیون تومان",
            "بین ۱۰ تا ۱۵ میلیون تومان",
            "بین ۸ تا ۱۰ میلیون تومان"
          ],
          "required": true,
          "autoNextOnChoice": true
        }
      ]
    },
    {
      "id": "s5",
      "title": "۵) چه زمانی می‌خواهید چاپ کتاب را آغاز کنید؟",
      "condition": {
        "field": "status",
        "equals": "در حال نوشتن یا آماده‌ی چاپ است"
      },
      "fields": [
        {
          "type": "choice",
          "name": "start_time",
          "label": "",
          "options": [
            "هفته‌ی آینده",
            "کمتر از یک ماه آینده",
            "سه ماه آینده",
            "فعلاً آمادگی چاپ ندارم"
          ],
          "required": true,
          "autoNextOnChoice": true
        }
      ]
    },
    {
    "id": "s6",
    "title": "۶) اطلاعات تماس شما",
    "autoSubmit":true,
    "onSubmitShowStep": "s7",
    "condition": {
      "any": [
        { "field": "status", "equals": "در حال نوشتن یا آماده‌ی چاپ است" },
        { "field": "status", "equals": "هنوز نوشتن را شروع نکرده‌ام" }
      ]
    },
    "fields": [
      {
        "type": "text",
        "name": "fullname",
        "label": "نام و نام خانوادگی",
        "required": true
      },
      {
        "type": "tel",
        "name": "phone",
        "label": "شماره همراه",
        "required": true
      }
    ]
  },
  {
    "id": "s7",
    "title": "✅ فرم با موفقیت ارسال شد",
    "hideButtons": true,
    "fields": [
      {
        "type": "html",
        "label": "<div style='text-align:center;padding:25px 15px;'><h2 style='color:#2ecc71;margin-bottom:10px;'>منتظر تماس ما باشید</h2><p style='font-size:16px;margin-bottom:20px;color:#444;'>همچنین شما می‌توانید با شماره زیر تماس بگیرید:</p><div style='display:inline-block;background:#f9f9f9;border:2px solid #2ecc71;border-radius:10px;padding:12px 20px;font-size:20px;font-weight:bold;color:#27ae60;direction:ltr;'>021-91091128 <span style='font-size:14px;color:#555;'>(داخلی 1)</span></div></div>"
      }
    ]
  }

  ]
}

```

🎨 استایل‌دهی و رنگ قالب

پلاگین از متغیر CSS زیر برای رنگ اصلی استفاده می‌کند:

```json
--sms-primary
```

اگر قالب شما این متغیر را نداشته باشد، رنگ پیش‌فرض قهوه‌ای (#795548) استفاده می‌شود.
همچنین رنگ‌ها در حالت Hover کمی تیره‌تر یا روشن‌تر نمایش داده می‌شوند.

💾 نکات فنی

داده‌های ارسال‌شده فعلاً در wp_options ذخیره می‌شوند.

در صورت نیاز به نمایش یا خروجی CSV، بخش مربوطه در کد کامنت شده است و قابل فعال‌سازی می‌باشد.

پلاگین کاملاً با قالب WoodMart و سایر قالب‌های مدرن سازگار است.

توسعه‌دهنده

ساخته شده:
حسن علی عسکری

---
